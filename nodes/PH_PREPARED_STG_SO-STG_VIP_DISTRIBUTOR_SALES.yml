fileVersion: 1
id: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
name: STG_VIP_DISTRIBUTOR_SALES
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: PH_PREPARED_STG_SO
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 49e53a41-5120-4c59-aa82-d23ced15d463
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: ID_VIP
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9afb72ad-89b0-4024-8124-eb648ac9d819
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0e6630da-04db-4939-9c10-e6dbb53b8674
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: ID_DISTRIBUTOR
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 85363312-331c-4ade-ab46-be6dcd2e71af
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9aff18d4-f232-4fac-8e50-1e8d3e99fbb7
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: ID_ACCOUNT
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 12f8c1d4-22f9-4480-944c-18fd00ac6c39
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 0a2af6ca-6594-449f-b083-5ac0bc68f489
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: ID_INVOICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 010bbd37-9eb7-44f4-9697-741eaa77bc2d
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - acceptedValues:
          strictMatch: true
          values: []
        appliedColumnTests: {}
        columnReference:
          columnCounter: e7ea753d-1ba2-45dd-aace-6f213c52cc84
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: NUMBER(38,0)
        defaultValue: ""
        description: ""
        keyColumnType: None
        name: INVOICE_LINE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 285e9b2f-1ea6-4b36-af92-f0988819ca3c
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
        systemColumnType: None
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5ade9e73-a705-4cd2-9e9b-511f346aa1c0
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: NUMBER(38,0)
        description: ""
        name: ID_DEPLETION_WAREHOUSE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a1b95615-2e7d-4500-b2e4-017947241186
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 5b8393eb-74e3-490b-bf96-86283aa9740f
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: SUPPLIER_ITEM_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c6712736-bedc-4997-bfb8-4a086583ecd4
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 1ff7a4e0-1db7-415d-b710-9398b60d5b04
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: DISTRIBUTOR_ITEM_NUMBER
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 7f2ebf58-3cf9-4994-8f7a-bd0c880e3805
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 269be12a-9622-44af-a64a-06bfb918a522
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: FLOAT
        description: ""
        name: QTY_BOTTLE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf610128-28f9-406e-8160-642d267bd2ad
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: |-
              CASE 
                  WHEN "DISTRIBUTOR_SALES"."UOM" = 'B' THEN "DISTRIBUTOR_SALES"."QTY"
                  WHEN DISTRIBUTOR_SALES."UOM" = 'C' THEN "DISTRIBUTOR_SALES"."QTY" * "DIM_ITEM"."ITEMS_PER_CASE"
                  ELSE NULL
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 08966eca-a0a8-457f-905e-f4ea3b2a8717
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: FLOAT
        description: ""
        name: QTY_FCE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf610128-28f9-406e-8160-642d267bd2ad
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: |-
              CASE 
                  WHEN "DISTRIBUTOR_SALES"."UOM" = 'B' THEN "DISTRIBUTOR_SALES"."QTY" * "DIM_ITEM"."BOTTLE_FCE"
                  WHEN DISTRIBUTOR_SALES."UOM" = 'C' THEN "DISTRIBUTOR_SALES"."QTY" * "DIM_ITEM"."SU_FCE"
                  ELSE NULL
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e61f7888-c60b-4dcc-ac7f-8aeb28b3c277
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: FLOAT
        description: ""
        name: QTY_CASE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cf610128-28f9-406e-8160-642d267bd2ad
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: |-
              CASE 
                  WHEN "DISTRIBUTOR_SALES"."UOM" = 'B' THEN "DISTRIBUTOR_SALES"."QTY" * "DIM_ITEM"."BOTTLE_TO_CASE"
                  WHEN DISTRIBUTOR_SALES."UOM" = 'C' THEN "DISTRIBUTOR_SALES"."QTY"
                  ELSE NULL
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: da966d27-3123-4f71-8102-6b94fa978c3f
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: TRANSACTION_TYPE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bedf82c9-05ea-461f-a5f3-d073bfb5b3cf
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e38df254-8d43-4e8a-98cb-5f888e67c41b
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: VARCHAR(256)
        description: ""
        name: TRANSACTION_DESCRIPTION
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: bedf82c9-05ea-461f-a5f3-d073bfb5b3cf
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: |-
              CASE
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'R' THEN 'retail sales'
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'B' THEN 'warehouse breakage'
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'T' THEN 'warehouse transfer'
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'E' THEN 'revenue adjustment (current month)'
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'V' THEN 'revenue adjustment (prior month)'
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'S' THEN 'supplier samples'
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'C' THEN 'credit memo'
                  WHEN "DISTRIBUTOR_SALES"."TRANS_TYPE" = 'D' THEN 'debit memo'
              END
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 8457ee5a-5c4d-41dd-8172-f646c8446ae1
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: DATE
        description: ""
        name: DATE_INVOICE
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b2fd8cc2-f1a0-4158-bea0-acd11d052f19
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: TO_DATE(TO_CHAR("DISTRIBUTOR_SALES"."INVOICE_DATE"), 'YYYYMMDD')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 57ed0ea6-76d6-4ac2-b6d0-ac5d7e862430
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: DATE
        description: ""
        name: DATE_FROM
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 571ae17d-84bd-46fd-800a-936afa4240b3
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: TO_DATE(TO_CHAR("DISTRIBUTOR_SALES"."FROM_DATE"), 'YYYYMMDD')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: f73452f3-2479-414b-b152-009073b40e19
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: DATE
        description: ""
        name: DATE_TO
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 9bf2ba91-7e01-4e14-bd83-648cd5e5cd70
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: TO_DATE(TO_CHAR("DISTRIBUTOR_SALES"."TO_DATE"), 'YYYYMMDD')
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 757bb0c4-68b8-483e-a197-5ac7c8ddf7aa
          stepCounter: cb9646a6-9f01-4914-ad8a-7c4bcc4bc6d0
        config: {}
        dataType: DATE
        description: ""
        name: DEPLETION_PERIOD
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 66568372-5aaa-44f8-96ed-8d59c256a726
                stepCounter: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
            transform: TO_DATE(TO_CHAR("DISTRIBUTOR_SALES"."DEPLETION_PERIOD"), 'YYYYMM')
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases:
          DIM_ITEM: 3018f1a7-ee58-4387-b7cd-1f7349cb485f
          DISTRIBUTOR_SALES: e3739ec3-f6fd-44e1-ae39-efa4d7108f1b
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: PH_PREPARED_SO
            nodeName: DIM_ITEM
          - locationName: PH_RAW_VIP
            nodeName: DISTRIBUTOR_SALES
        join:
          joinCondition: |-
            FROM {{ ref('PH_RAW_VIP', 'DISTRIBUTOR_SALES') }} "DISTRIBUTOR_SALES"
            LEFT JOIN {{ ref('PH_PREPARED_SO', 'DIM_ITEM') }} "DIM_ITEM"
                ON "DISTRIBUTOR_SALES"."SUPP_ITEM" = "DIM_ITEM"."ITEM_NUMBER"
            WHERE "DISTRIBUTOR_SALES"."ACCT_NBR" != 'SRS99'
        name: STG_VIP_DISTRIBUTOR_SALES
        noLinkRefs: []
  name: STG_VIP_DISTRIBUTOR_SALES
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
